# Maintainer: Maurizio Porrato <maurizio.porrato@gmail.com>

pkgname=janus-gateway-git
pkgver=0.0.6.r87.g0881acc
pkgrel=2
pkgdesc="WebRTC gateway."
arch=('i686' 'x86_64')
url="http://janus.conf.meetecho.com/"
license=('GPL3')
depends=('libmicrohttpd' 'jansson' 'libnice' 'openssl' 'libsrtp' 'sofia-sip' 'sctp-refimpl-svn' 'libwebsock-nothreads' 'libevent' 'librabbitmq-c' 'opus' 'libogg' 'glib2' 'ding-libs') 
makedepends=('git' 'libtool' 'automake' 'autoconf' 'gcc' 'make' 'pkg-config' 'gengetopt' 'patch')
provides=(janus-gateway)
backup=('etc/janus/janus.cfg')
install=janus-gateway-git.install

source=('git+https://github.com/meetecho/janus-gateway.git'
        'install-conf.patch')
md5sums=('SKIP'
         '17955203b7d06f5c887638e621d7b3c1')
_gitname="janus-gateway"

pkgver() {
  cd "$srcdir/${_gitname}"
  git describe --long | sed -r 's/([^-]*-g)/r\1/;s/-/./g;s/^v//'
}

prepare() {
  cd "$srcdir/${_gitname}"
  patch < "$startdir/install-conf.patch"
}

build() {
  cd "$srcdir/${_gitname}"
  ./autogen.sh
  ./configure --prefix=/usr --sysconfdir=/etc --disable-docs
  DESTDIR="$pkgdir/" make
}

package() { 
  cd "$srcdir/${_gitname}"
  DESTDIR="$pkgdir/" make install configs
  rm -f "$pkgdir/usr/share/janus/certs/mycert.{key,pem}"
} 

